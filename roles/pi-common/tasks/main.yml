
# requires playbook reboot and wait handler.


- name: change pi user password
  user:
    name: pi
    password: "{{ pi_password_hash }}"

- name: fix timezone
  copy:
    content: "{{timezone}}"
    dest: "/etc/timezone"
  notify: reboot and wait

- name: Run the equivalent of "apt dist-update"
  apt:
    update_cache: yes
    upgrade: dist
  notify: reboot and wait

- name: install a few packages
  apt:
    name: "{{item}}"
    state: latest
  with_items: "{{required_packages}}"
  notify: reboot and wait

- name: disable serial port
  lineinfile:
    dest: /boot/config.txt
    regexp: "enable_uart="
    line: "enable_uart=0"
    state: present
  notify: reboot and wait

- name: remove serial getty
  replace:
    path: /boot/cmdline.txt
    regexp: ' console=serial0,115200'
    replace: ''

- name: stop trigger happy hotkey service
  systemd:
    name: triggerhappy.service
    state: stopped
    enabled: false
